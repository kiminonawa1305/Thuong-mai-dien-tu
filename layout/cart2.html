<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/cart.css">
    <link rel="stylesheet" href="../css/product.css">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0"/>
    <script src="../js/jquery.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/bootstrap.bundle.min.js"></script>
    <!--    <script src="../js/bootstrap.esm.min.js"></script>-->
    <script src="../js/fontawesome.js" crossorigin="anonymous"></script>

    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0"/>
    <title>Giỏ hàng</title>
</head>
<body>
<main>
    <section class="d-flex justify-content-center align-items-lg-center">
        <div class="container py-3 card d-flex justify-content-center">
            <form action="#" method="post" class="needs-validation">
                <div class="header-cart">Giỏ hàng</div>
                <div class="alert alert-success d-inline-block note-cart">
                    Quý khách vui lòng đợi 5s - 10s trước khi ấn "Tiến hành đặt hàng" để giỏ hàng cập nhật quà tặng (nếu
                    có). Cảm ơn quý khách đã tin tưởng và ủng hộ Kimi Shop!
                </div>
                <div></div>
                <div class="cart-content row ">
                    <div class="cart-product-list">
                        <cart_item></cart_item>
                        <cart_item></cart_item>
                    </div>
                    <div class="cart-price card py-3">
                        <div class="d-flex justify-content-between">
                            <div class="mb-3">Tổng tiền</div>
                            <div class="cart-price-total"><span>49000</span>đ</div>
                        </div>
                        <input class="btn btn-primary rounded-2" type="submit" id="btn-submit"
                               value="Tiến hành đặt hàng"/>
                    </div>
                </div>
                <div class="cart-title-ship mb-lg-3">
                    <i class="fa-solid fa-truck-fast text-primary"></i><span>Miễn phí vận chuyển cho đơn hàng từ 200,000₫</span>
                </div>
                <div class="cart-footer w-50">
                    <div class="form-check mb-lg-3">
                        <input class="form-check-input" type="checkbox" value="" id="checkbox-bill">
                        <label class="form-check-label text-danger" for="checkbox-bill">
                            Xuất hóa đơn công ty
                        </label>
                    </div>
                    <div class="d-none" id="bill-field">
                        <div class="input-group mb-3">
                            <input class="form-control" type="text" placeholder="Tên công ty" aria-label="Tên công ty">
                        </div>
                        <div class="input-group mb-3">
                            <input class="form-control" type="text" placeholder="Mã số thuế" aria-label="Mã số thuế">
                        </div>
                        <div class="input-group mb-3">
                            <input class="form-control" type="text" placeholder="Địa chỉ công ty" aria-label="Địa chỉ công ty">
                        </div>
                        <div class="input-group mb-3">
                            <input class="form-control" type="email" placeholder="Địa chỉ email công ty" aria-label="Địa chỉ email công ty">
                            <div class="invalid-feedback">Please enter email format</div>
                        </div>
                    </div>

                    <div class="cart-order-note">
                        <label for="note" class="form-label">Ghi chú đơn hàng</label>
                        <textarea class="form-control" id="note" name="note"></textarea>
                    </div>
                </div>
            </form>
        </div>
    </section>
    <section class="relation-product">
        <div class="relation-product-title">
            <button class="px-3 py-1 bg-primary fs-4 text-white fw-medium border-0 rounded-2">Sản phẩm bán chạy</button>
        </div>
        <div class="relation-product-body">
            <div id="carouselExample" class="carousel slide"  data-bs-ride="carousel" data-bs-interval="5000">
                <div class="carousel-inner">
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </section>


</main>
<script>

    $("cart_item").load("../component/cart_item2.html");

    $(document).ready(function () {

        let forms = $('.needs-validation');
        console.log(forms);

        // Loop over them and prevent submission
        forms.on('submit', function(event) {
            if (!this.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            console.log('hello')
            $(this).addClass('was-validated');
        });

        $('#checkbox-bill').change(function () {
            if ($(this).is(':checked')) {
                $('#bill-field').removeClass('d-none');
                $('#bill-field input').attr('required', true);
            } else {
                $('#bill-field').addClass('d-none');
                $('#bill-field input').attr('required', false);
            }
        });


        // Dữ liệu product mẫu
        let productList = [
            {id: 1, name: "Product 1", newPrice: 100000, oldPrice: 120000, tag: "-20%"},
            {id: 2, name: "Product 2", newPrice: 150000, oldPrice: 180000, tag: "-15%"},
            {id: 3, name: "Product 3", newPrice: 200000, oldPrice: 250000, tag: "-10%"},
            {id: 4, name: "Product 4", newPrice: 120000, oldPrice: 140000, tag: "-25%"},
            {id: 5, name: "Product 5", newPrice: 180000, oldPrice: 200000, tag: "-10%"},
            {id: 6, name: "Product 6", newPrice: 220000, oldPrice: 250000, tag: "-12%"},
            {id: 7, name: "Product 7", newPrice: 130000, oldPrice: 150000, tag: "-13%"},
            {id: 8, name: "Product 8", newPrice: 170000, oldPrice: 200000, tag: "-15%"},
            {id: 9, name: "Product 9", newPrice: 190000, oldPrice: 220000, tag: "-13%"},
            {id: 10, name: "Product 10", newPrice: 250000, oldPrice: 280000, tag: "-10%"},
            {id: 11, name: "Product 11", newPrice: 250000, oldPrice: 280000, tag: "-10%"}
        ];
        const carouselInner = $('.carousel-inner');
        let startIndex = 0;


        function createCarousel(productList) {
            carouselInner.empty();

            // Tính số lượng carousel được tạo ra
            let numCarousel = productList.length/5;
            if (numCarousel > Math.round(numCarousel)) {
                numCarousel = Math.round(numCarousel) + 1;
            }

            console.log(numCarousel)
            for (let i = 0; i < numCarousel; i++) {
                let carousel = $('<div>').addClass('carousel-item');
                let productDiv = $('<div>').addClass('product-list');
                let count = 0;
                for (let j = i * 5; j < productList.length && count < 5; j++, count++) {
                    let productCard = `<product data-id=${productList[j].length}></product>`;
                    productDiv.append(productCard);
                }
                carousel.append(productDiv);
                carouselInner.append(carousel);
            }
            $("product").load("../component/product.html");


           setTimeout(()=>{
               updateProduct();
               $('.carousel-item').first().addClass('active');
           }, 500);
        }
        createCarousel(productList);

        function updateProduct() {
                let products =  $(".product");
                console.log(products)
                products.each((index,item)=>{
                    let currentItem = $(item);
                    currentItem.find(".title").text(productList[startIndex + index].name);
                    currentItem.find(".new-price").text(productList[startIndex + index].newPrice);
                    currentItem.find(".old-price").text(productList[startIndex + index].oldPrice);
                    currentItem.find(".tag").text(productList[startIndex + index].tag);
                })
            }
        const carouselAnimation = new bootstrap.Carousel($('#carouselExample'), {
           interval: 10000
        });
    });
</script>
</body>
</html>